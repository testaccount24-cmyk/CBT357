/**  REXX -- GATHER ALL THE EXCLUDED LINES AT THE TOP  **/
   SAVEMSG = MSG()
   IF SAVEMSG = 'OFF' THEN
      X = MSG("ON")
   X = ADDRESS()
   SUBCOM ISPEXEC
   IF RC <> 0 THEN DO
      SAY 'GATHERX MUST BE RUN UNDER ISPF EDIT!'
      SIGNAL EOJ
   END
   SUBCOM ISREDIT
   UMODE = "ISREDIT"
   ADDRESS ISPEXEC "CONTROL ERRORS RETURN"
   ADDRESS ISREDIT
   "MACRO (PARMS) NOPROCESS"
   IF PARMS = '?' THEN SIGNAL DISPDOC
   "PROCESS RANGE C"
   IF RC > 0 THEN
      DO
         "(TOP) = LINENUM .ZFIRST"
         "(BOT) = LINENUM .ZLAST"
      END
   ELSE
      DO
         "(TOP) = LINENUM .ZFRANGE"
         "(BOT) = LINENUM .ZLRANGE"
      END

   NUMTIMES = BOT - TOP + 1
   NUMHANDLED = 0

   DO II = TOP TO BOT
      "(LINESTAT) = XSTATUS" II
      IF LINESTAT = "NX" THEN DO
         "ISREDIT (RECORD) = LINE" II
         "ISREDIT LINE_AFTER &BOT = (RECORD)"
         "ISREDIT DELETE" II
         II = II - 1
      END
      NUMHANDLED = NUMHANDLED + 1
      IF NUMHANDLED >= NUMTIMES THEN II = BOT + 1
   END

QUIT:
   ADDRESS ISPEXEC
   X=MSG(SAVEMSG)
   IF TOP = 1 THEN ADDRESS ISREDIT "LOCATE 0"
              ELSE DO
                 TOP = TOP - 1
                 ADDRESS ISREDIT "LOCATE" TOP
              END
   EXIT(0)

DISPDOC:
   ADDRESS TSO "CLEAR"
   SAY "GATHERX -- PULL ALL EXCLUDED LINES TO THE TOP OF THE FILE "
   SAY
   SAY " FORMAT "
   SAY "    GATHERX                                               "
   SAY "       ALL EXCLUDED LINES WILL BE MOVED TO THE TOP OF THE "
   SAY "       FILE, KEEPING BOTH THEM AND THE NON-EXCLUDED LINES "
   SAY "       IN THE SAME ORDER.                                 "
   SAY
   EXIT(1)

